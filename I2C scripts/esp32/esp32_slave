#include <Wire.h>

#define I2C_DEV_ADDR 0x55

uint32_t counter = 0;

void onRequest() {
  String reply = "Packet #" + String(counter++);
  Wire.write((const uint8_t*)reply.c_str(), reply.length());
  Serial.print("[SLAVE] onRequest sent: ");
  Serial.println(reply);
}

void onReceive(int len) {
  Serial.printf("[SLAVE] onReceive (%d bytes): ", len);

  while (Wire.available()) {
    Serial.write(Wire.read());
  }
  Serial.println();
}

void setup() {
  Serial.begin(9600);
  delay(200);
  Serial.println("I2C Slave Starting...");

  Wire.onReceive(onReceive);
  Wire.onRequest(onRequest);
  Wire.begin((uint8_t)I2C_DEV_ADDR);
}

void loop() {
  //
}
