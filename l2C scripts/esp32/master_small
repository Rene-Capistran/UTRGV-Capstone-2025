#include <Wire.h>

#define I2C_DEV_ADDR 0x55

void setup() {
  Serial.begin(9600);
  delay(200);
  Serial.println("I2C Master Starting...");

  Wire.begin();
}

void loop() {
  delay(200);

  const char *msg = "Hello, world!";
  
  Serial.print("[MASTER] Sending: ");
  Serial.println(msg);

  Wire.beginTransmission(I2C_DEV_ADDR);
  Wire.write((uint8_t*)msg, strlen(msg));
  uint8_t result = Wire.endTransmission();

  Serial.printf("[MASTER] endTransmission result: %u\n", result);

  uint8_t bytesReceived = Wire.requestFrom(I2C_DEV_ADDR, 32);
  Serial.printf("[MASTER] requestFrom returned %u bytes\n", bytesReceived);

  if (bytesReceived > 0) {
    Serial.print("[MASTER] Received: ");
    while (Wire.available()) {
      Serial.write(Wire.read());
    }
    Serial.println();
  }
}

